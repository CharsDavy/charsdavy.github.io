<!DOCTYPE html>
<html>
<head> 
  <meta charset="utf-8" /> 
  <title>Xcode插件开发教程指南 | Chars Davy</title> 
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
  <meta name="description" content="在平时开发过程中我们使用了很多的Xcode插件，虽然官方对于插件制作没有提供任何支持，但是加载三方的插件，默认还是被允许的。第三方的插件，存放在 ~/Library/Application Support/Developer/Shared/Xcode/Plug-ins文件夹中，后缀名必须是.xcplugin ，其实际上是一种bundle。所以我们创建一个插件工程，直接创建bundle工程即可。然后通过修改后缀名为.xcplugin，将其放到~/Library/Application Support/Developer/Shared/Xcode/Plug-ins目录中即可。" /> 
  <meta property="og:type" content="article" /> 
  <meta property="og:title" content="Xcode插件开发教程指南" /> 
  <meta property="og:url" content="http://yoursite.com/2016/04/08/iOS-Xcode-Plugin/index.html" /> 
  <meta property="og:site_name" content="Chars Davy" /> 
  <meta property="og:description" content="在平时开发过程中我们使用了很多的Xcode插件，虽然官方对于插件制作没有提供任何支持，但是加载三方的插件，默认还是被允许的。第三方的插件，存放在 ~/Library/Application Support/Developer/Shared/Xcode/Plug-ins文件夹中，后缀名必须是.xcplugin ，其实际上是一种bundle。所以我们创建一个插件工程，直接创建bundle工程即可。然后通过修改后缀名为.xcplugin，将其放到~/Library/Application Support/Developer/Shared/Xcode/Plug-ins目录中即可。" /> 
  <meta property="og:updated_time" content="2016-04-08T01:53:03.000Z" /> 
  <meta name="twitter:card" content="summary" /> 
  <meta name="twitter:title" content="Xcode插件开发教程指南" /> 
  <meta name="twitter:description" content="在平时开发过程中我们使用了很多的Xcode插件，虽然官方对于插件制作没有提供任何支持，但是加载三方的插件，默认还是被允许的。第三方的插件，存放在 ~/Library/Application Support/Developer/Shared/Xcode/Plug-ins文件夹中，后缀名必须是.xcplugin ，其实际上是一种bundle。所以我们创建一个插件工程，直接创建bundle工程即可。然后通过修改后缀名为.xcplugin，将其放到~/Library/Application Support/Developer/Shared/Xcode/Plug-ins目录中即可。" /> 
  <link rel="alternative" href="/atom.xml" title="Chars Davy" type="application/atom+xml" /> 
  <link rel="icon" href="/favicon.png" /> 
  <link rel="stylesheet" href="/css/style.css" type="text/css" /> 
</head> 
<body> 
  <div id="container"> 
   <div class="left-col"> 
    <div class="overlay"></div> 
    <div class="intrude-less"> 
     <header id="header" class="inner"> 
      <a href="/" class="profilepic"> <img lazy-src="/img/myAvatar.png" class="js-avatar" /> </a> 
      <hgroup> 
       <h1 class="header-author"><a href="/">Chars Davy</a></h1> 
     </hgroup> 
     <p class="header-subtitle">无所谓的态度，过着随遇而安的生活</p> 
     <div class="switch-btn"> 
       <div class="icon"> 
        <div class="icon-ctn"> 
         <div class="icon-wrap icon-house" data-idx="0"> 
          <div class="birdhouse"></div> 
          <div class="birdhouse_holes"></div> 
        </div> 
        <div class="icon-wrap icon-ribbon hide" data-idx="1"> 
          <div class="ribbon"></div> 
        </div> 
        <div class="icon-wrap icon-link hide" data-idx="2"> 
          <div class="loopback_l"></div> 
          <div class="loopback_r"></div> 
        </div> 
        <div class="icon-wrap icon-me hide" data-idx="3"> 
          <div class="user"></div> 
          <div class="shoulder"></div> 
        </div> 
      </div> 
    </div> 
    <div class="tips-box hide"> 
      <div class="tips-arrow"></div> 
      <ul class="tips-inner"> 
       <li>菜单</li> 
       <li>标签</li> 
       <li>友情链接</li> 
       <li>关于我</li>
     </ul> 
   </div> 
 </div> 
 <div class="switch-area"> 
   <div class="switch-wrap"> 
    <section class="switch-part switch-part1"> 
     <nav class="header-menu"> 
      <ul> 
       <li><a href="/">主页</a></li> 
       <li><a href="/archives">所有文章</a></li> 
     </ul> 
   </nav> 
   <nav class="header-nav"> 
    <div class="social"> 
     <a class="github" target="_blank" href="https://github.com/charsdavy" title="github">github</a> 
     <a class="zhihu" target="_blank" href="http://www.zhihu.com/people/chars" title="zhihu">zhihu</a> 
     <a class="mail" target="_blank" href="mailto:chars_d@126.com" title="e-mail">email</a>
     <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a> 
   </div> 
 </nav> 
</section> 
<section class="switch-part switch-part2"> 
 <div class="widget tagcloud" id="js-tagcloud"> 
  <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> 
  <a href="/tags/效率/" style="font-size: 10px;">效率</a> 
  <a href="/tags/碎碎念/" style="font-size: 10px;">碎碎念</a> 
  <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a>
  <a href="/tags/script/" style="font-size: 10px;">script</a>
</div> 
</section> 
<section class="switch-part switch-part3"> 
 <div id="js-friends"> 
  <ul>
    <li><a target="_blank" class="main-nav-link switch-friends-link" href="http://exodia.net/">Exodia</a> </li>
    <li><a target="_blank" class="main-nav-link switch-friends-link" href="http://casatwy.com/">Casa Taloyum</a></li>
  </ul>
</div> 
</section> 
<section class="switch-part switch-part4"> 
  <p>Chars Davy @ ZAKER</p>
  <p>立志成为全栈工程师。</p>
  <p>爱好户外运动，喜欢登山、游泳。喜欢一个人静静的写代码。</p>
</br> </br>
<ul>
  <li><a href="/img/weixin-pay.png">微信打赏支持</a></li>
  <li><a href="/img/ali-pay.jpg">支付宝打赏支持</a></li>
</ul>

</section> 
</div> 
</div> 
</header> 
</div> 
</div> 
<div class="mid-col"> 
  <nav id="mobile-nav"> 
   <div class="overlay"> 
    <div class="slider-trigger"></div> 
    <h1 class="header-author js-mobile-header hide">Chars Davy</h1> 
  </div> 
  <div class="intrude-less"> 
    <header id="header" class="inner"> 
     <div class="profilepic"> 
      <img lazy-src="/img/myAvatar.png" class="js-avatar" /> 
    </div> 
    <hgroup> 
      <h1 class="header-author">Chars Davy</h1> 
    </hgroup> 
    <p class="header-subtitle">无所谓的态度，过着随遇而安的生活</p> 
    <nav class="header-menu"> 
      <ul> 
       <li><a href="/">主页</a></li> 
       <li><a href="/archives">所有文章</a></li> 
       <div class="clearfix"></div> 
     </ul> 
   </nav> 
   <nav class="header-nav"> 
    <div class="social"> 
     <a class="github" target="_blank" href="https://github.com/charsdavy" title="github">github</a> 
     <a class="zhihu" target="_blank" href="http://www.zhihu.com/people/chars" title="zhihu">zhihu</a> 
     <a class="mail" target="_blank" href="mailto:chars_d@126.com" title="e-mail">email</a>
     <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a> 
   </div> 
 </nav> 
</header> 
</div> 
</nav> 
<div class="body-wrap"> 
 <article id="post-new" class="article article-type-post" itemscope="" itemprop="blogPost"> 
  <div class="article-meta"> 
   <a href="/2016/04/08/iOS-Xcode-Plugin/" class="article-date"> <time datetime="2016-04-08T01:53:03.000Z" itemprop="datePublished">2016-04-08</time> </a> 
 </div> 
 <div class="article-inner"> 
   <input type="hidden" class="isFancy" /> 
   <header class="article-header"> 
    <h1 class="article-title" itemprop="name"> Xcode插件开发教程指南 </h1> 
  </header> 
  <div class="article-info article-info-post"> 
    <div class="article-tag tagcloud"> 
     <ul class="article-tag-list"> 
      <li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li> 
    </ul> 
  </div> 
  <div class="clearfix"></div> 
</div> 
<div class="article-entry" itemprop="articleBody"> 
  <p>在平时开发过程中我们使用了很多的Xcode插件，虽然官方对于插件制作没有提供任何支持，但是加载三方的插件，默认还是被允许的。第三方的插件，存放在 ~/Library/Application Support/Developer/Shared/Xcode/Plug-ins文件夹中，后缀名必须是.xcplugin ，其实际上是一种bundle。所以我们创建一个插件工程，直接创建bundle工程即可。然后通过修改后缀名为.xcplugin，将其放到~/Library/Application Support/Developer/Shared/Xcode/Plug-ins目录中即可。</p> 
  <p>Xcode插件开发现在主要通过两种方式实现，其实也就是一种，只不过其中一种是使用别人提供的开发模板来省去很多中间步骤而已。文章会依次详细介绍两种的实现方法。</p> 
  <h1>准备工作</h1> 
  <h2>方式一：通过Bundle实现</h2> 
  <p>&nbsp;1.创建Bundle工程</p> 
  <p><img src="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330144728207-192574452.png" alt="" /></p> 
  <p>2.工程设置</p> 
  <p id="首先是工程的plist文件">插件工程和普通的bundle工程还是有区别的,所以需要进行特殊的设置。</p> 
  <p>1）工程的plist文件</p> 
  <p><img src="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330144905629-871612988.png" alt="" /></p> 
  <p>添加三项： <br /> XCPluginHasUI = NO <br /> XC4Compatible = YES <br /> DVTPlugInCompatibilityUUIDs 这是一个数组。数组内容字符串，指示了该插件兼容的Xcode版本，只有对应版本的Xcode的UIID加入这个数组，插件才能被加载。否则，即使将插件放入Xcode的插件文件夹，插件也不会被加载。<br /> 获取当前版本的Xcode的UUID方式：</p> 
  <p>在terminal中输入命令：</p> 
  <p> defaults read /Applications/Xcode.app/Contents/Info DVTPlugInCompatibilityUUID </p> 
  <p>terminal会返回一串字符串，这就是Xcode的DVTPlugInCompatibilityUUID。</p> 
  <p id="接下来是-build-setting了">2）Build Setting</p> 
  <p><img src="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330145158129-342161810.png" alt="" /></p> 
  <p>&nbsp;</p> 
  <p><img src="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330145210144-303815379.png" alt="" /></p> 
  <p>Installation Build Products Location 设置为 ${HOME} [显示的时候,显示的是你的用户目录]，这个是products的根目录。</p> 
  <p>Installation Directory 设置为 /Library/Application Support/Developer/Shared/Xcode/Plug-ins，这个是指定你的插件安装的目录。 注意，这里填入的其实是相对目录。插件的绝对目录是这样的，例如 /Users/yohunl/Library/Application\ Support/Developer/Shared/Xcode/Plug-ins/Alcatraz.xcplugin ，最后的绝对目录是 Installation Build Products Location和Installation Directory的结合，这也是为什么两者都要设置的原因。</p> 
  <p>Deployment Location 设置为 YES，这个是指示该工程不使用设置里的build location，而是用Installation Directory来确定build后放置的位置。</p> 
  <p><img src="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330145434019-1733725866.png" alt="" /></p> 
  <p>默认工程生成的相关文件位置都是 Build Locations指定的，通过Deployment Location 设置为 YES告诉工程，我们不使用这个默认的设置，而是我们自定义的。</p> 
  <p>Wrapper extension 设置为 xcplugin，后缀名必须为xcplugin，否则不会被加载。</p> 
  <h2>方式二：通过模板实现</h2> 
  <p>&nbsp;1）下载Xcode插件开发模板</p> 
  <p>地址：<a href="https://github.com/kattrali/Xcode-Plugin-Template" target="_blank">https://github.com/kattrali/Xcode-Plugin-Template</a><br /><br />2）将下载下来的template复制到 ~/Library/Developer/Xcode/Templates/Project Templates/Application Plug-in/Xcode Plugin.xctemplate文件夹中，如果没有对应的文件夹就自己手动创建一个。<br /><br />3）重启Xcode，当你新建一个工程的时候就可以在OS X中看到一个Application Plug-in的选项，里面有一个Xcode Plug-in模板。</p> 
  <p><img src="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330150045894-1159966575.png" alt="" /></p> 
  <h1>实现</h1> 
  <p>通过以上的两种准备方式，我们已可以创建Xcode插件工程，接下来就是如何实现插件功能。</p> 
  <p>&nbsp;1.功能需求</p> 
  <p>在当前选中文件中实现代码风格重构，目前主要实现setter方法这一风格重构。例如，</p> 
  <p>[self setName:@&quot;Davy&quot;]; ==&gt; self.name = @&quot;Davy&quot;;</p> 
  <p>2.思路分析</p> 
  <p>1）找到当前文件中符合setter方法命名风格的方法调用。</p> 
  <p>2）替换找到的符合重构风格的代码，提醒用户保存。</p> 
  <p>3.技术难点</p> 
  <p>1）Xcode代码编辑框文件内容操作。</p> 
  <p>2）正则表达式书写。</p> 
  <p>3）Xcode代码编辑框提醒用户保存文件。</p> 
  <p>关于最后一点，因为Xcode对于没有保存的已修改过的文件会显灰以提示用户该文件需要保存，我们可以借鉴这种方式。另外，在查找时，如果能够实现高亮并且跟随滚动，效果会更佳。</p> 
  <p>4.关键代码</p> 
  <p>&nbsp;以上这些问题，本人在“Refactor Code”插件中全部实现，现在放上关键方法。</p> 
  <p>1）添加菜单</p> 
  <div class="cnblogs_code"> 
   <pre>-(<span>void</span><span>) setupMenuItem
    {
  </span><span>//</span><span> Menu Item:</span>
  <span>    
    NSMenuItem </span>*editMenuItem = [[NSApp mainMenu] itemWithTitle:<span>@&quot;</span><span>Edit</span><span>&quot;</span><span>];
    
  </span><span>if</span><span> (editMenuItem) {
  [[editMenuItem submenu] addItem:[NSMenuItem separatorItem]];
  
  NSMenu </span>*refactorCodeMenu = [[NSMenu alloc] initWithTitle:<span>@&quot;</span><span>Refactor Code</span><span>&quot;</span><span>];
  
  NSMenuItem </span>*<span>menuItem;
  menuItem </span>= [[NSMenuItem alloc] initWithTitle:<span>@&quot;</span><span>Refactor Method Style</span><span>&quot;</span> action:@selector(refactorMethodStyleMenuAction) keyEquivalent:<span>@&quot;&quot;</span><span>];
  [menuItem setTarget:self];
  [refactorCodeMenu addItem:menuItem];
  
  NSMenuItem </span>*refactorCodeMenuItem = [[NSMenuItem alloc] initWithTitle:<span>@&quot;</span><span>Refactor Code</span><span>&quot;</span> action:nil keyEquivalent:<span>@&quot;&quot;</span><span>];
  [refactorCodeMenuItem setSubmenu:refactorCodeMenu];
  [[editMenuItem submenu] addItem:refactorCodeMenuItem];
}
}</span></pre> 
</div> 
<p>效果图如下：</p> 
<p><img src="http://images2015.cnblogs.com/blog/490781/201604/490781-20160401135707035-2105407027.png" alt="" width="390" height="417" /></p> 
<p>2）显示操作面板</p> 
<div class="cnblogs_code"> 
 <pre>- (<span>void</span><span>)refactorMethodStyleMenuAction
  {
  [self.operateController showWindow:nil];
  
  NSURL </span>*url = [[NSBundle bundleForClass:[self <span>class</span>]] URLForResource:<span>@&quot;</span><span>DZOperateController</span><span>&quot;</span> withExtension:<span>@&quot;</span><span>nib</span><span>&quot;</span><span>];
  
</span><span>if</span> (!<span>url) {
NSAlert </span>*alert =<span> [[NSAlert alloc] init];
alert.messageText </span>= <span>@&quot;</span><span>Refactor Method Style could not be shown because the plugin is corrupted.</span><span>&quot;</span><span>;
alert.informativeText </span>= <span>@&quot;</span><span>If you build the plugin from sources using Xcode, make sure to perform “Clean Build Folder“ in <br />　　　　　　　　Xcode and then build the plugin again.\n\nIf you installed the plugin via Alctraz, there is a pending issue causing <br />　　　　　　　　some files to be missing in the plugin. Prefer to install it via the plugin webpage.</span><span>&quot;</span><span>;
[alert addButtonWithTitle:</span><span>@&quot;</span><span>Download Latest</span><span>&quot;</span><span>];
[alert addButtonWithTitle:</span><span>@&quot;</span><span>Cancel</span><span>&quot;</span><span>];
NSModalResponse result </span>=<span> [alert runModal];

</span><span>if</span> (result ==<span> NSAlertFirstButtonReturn) {
[[NSWorkspace sharedWorkspace] openURL:[NSURL URLWithString:</span><span>@&quot;</span><span>https://github.com/CharsDavy/RefactorCodePlugin-Xcode</span><span>&quot;</span><span>]];
}
}
}</span></pre> 
</div> 
<p>效果图如下：</p> 
<p><img src="http://images2015.cnblogs.com/blog/490781/201604/490781-20160401135950379-1172628646.png" alt="" /></p> 
<p>3）查找替换代码风格</p> 
<p>这一部分是重点部分，包括如何书写正则表达式，并且利用正则表达式生成替换字符。还包括高亮代码，具体可以参见本人源码：<a href="https://github.com/CharsDavy/RefactorCodePlugin-Xcode" target="_blank">https://github.com/CharsDavy/RefactorCodePlugin-Xcode</a></p> 
<p>4）最终效果图</p> 
<p><img src="http://images2015.cnblogs.com/blog/490781/201604/490781-20160401140322598-323202767.png" alt="" /></p> 
<h1>提交插件至Alcatraz</h1> 
<p>1.打开Alcatraz的插件包仓库，地址：<a href="https://github.com/supermarin/alcatraz-packages" target="_blank">https://github.com/supermarin/alcatraz-packages</a></p> 
<p>2.在简介里可以看到Alcatraz的包分为三类，分别为：插件(plugins)，配色方案(color schemes)和模板(templates)。<br /> 每个包都必须包含”name”、”url”和”description”字段，还有一个可选的”screenshot”字段。</p> 
<p>3.Fork这个仓库，再克隆到本地。</p> 
<p>4.以添加”Refactor Code”插件为例，打开packages.json文件，在”plugins”数组里加入：</p> 
<div class="cnblogs_code"> 
 <pre><span>    {
 </span><span>&quot;</span><span>name</span><span>&quot;</span>: <span>&quot;</span><span>Refactor Code</span><span>&quot;</span><span>,
</span><span>&quot;</span><span>url</span><span>&quot;</span>: <span>&quot;</span><span>https://github.com/CharsDavy/RefactorCodePlugin-Xcode.git</span><span>&quot;</span><span>,
</span><span>&quot;</span><span>description</span><span>&quot;</span>: <span>&quot;</span><span>Refactor code style,such as setter method.</span><span>&quot;</span><span>,
</span><span>&quot;</span><span>screenshot</span><span>&quot;</span>: <span>&quot;</span><span>https://github.com/CharsDavy/RefactorCodePlugin-Xcode/raw/master/Screenshots/window.png</span><span>&quot;</span><span>
}</span></pre> 
</div> 
<p>5.提交代码到Fork的地址，再提交一个pull request到Master即可。</p> 
<p>6.merged成功之后，即可看见以下效果图</p> 
<p><img src="http://images2015.cnblogs.com/blog/490781/201604/490781-20160401092906176-1572332699.png" alt="" /></p> 
<p>&nbsp;希望对大家有所帮助。</p> 
</div> 
</div> 
<nav id="article-nav"> 
  <a href="/2016/04/10/design-pattern-brief/" id="article-nav-newer" class="article-nav-link-wrap"> <strong class="article-nav-caption">&lt;</strong> 
    <div class="article-nav-title">
     设计模式简介
   </div> </a> 
   <a href="/2016/04/05/iOS-inner-messaging/" id="article-nav-older" class="article-nav-link-wrap"> 
    <div class="article-nav-title">
     iOS页面内消息通信机制 
   </div> <strong class="article-nav-caption">&gt;</strong> </a>
 </nav> 
</article> 
<div class="share"> 
  <!-- JiaThis Button BEGIN --> 
  <div class="jiathis_style"> 
   <span class="jiathis_txt">分享到：</span> 
   <a class="jiathis_button_tsina"></a> 
   <a class="jiathis_button_cqq"></a> 
   <a class="jiathis_button_douban"></a> 
   <a class="jiathis_button_weixin"></a> 
   <a class="jiathis_button_tumblr"></a> 
   <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a> 
 </div> 
 <script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script> 
 <!-- JiaThis Button END --> 
</div> 
<div class="duoshuo"> 
  <!-- 多说评论框 start --> 
  <div class="ds-thread" data-thread-key="iOS-Xcode-Plugin" data-title="Xcode插件开发教程指南" data-url="http://yoursite.com/2016/04/08/iOS-Xcode-Plugin/"></div> 
  <!-- 多说评论框 end --> 
  <!-- 多说公共JS代码 start (一个网页只需插入一次) --> 
  <script type="text/javascript">
    var duoshuoQuery = {short_name:"charsdavy"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0] 
       || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script> 
  <!-- 多说公共JS代码 end --> 
</div> 
</div> 
<footer id="footer"> 
 <div class="outer"> 
  <div id="footer-info"> 
   <div class="footer-left">
     &copy; 2016 Chars Davy
   </div> 
 </div> 
</div> 
</footer> 
</div> 
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css" /> 
<script>
  var yiliaConfig = {
    fancybox: true,
    mathjax: true,
    animate: true,
    isHome: false,
    isPost: true,
    isArchive: false,
    isTag: false,
    isCategory: false,
    open_in_new: false
  }
</script> 
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script> 
<script src="/js/main.js" type="text/javascript"></script> 
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
  tex2jax: {
  inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
  processEscapes: true,
  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
}
});

MathJax.Hub.Queue(function() {
var all = MathJax.Hub.getAllJax(), i;
for(i=0; i < all.length; i += 1) {
all[i].SourceElement().parentNode.className += ' has-jax';                 
}       
});
</script> 
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script> 
</div>  
</body>
</html>