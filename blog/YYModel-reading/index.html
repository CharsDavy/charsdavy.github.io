
<!doctype html>














<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/assets/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/assets/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/assets/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="框架,ios," />





  <link rel="alternate" href="/atom.xml" title="Chars's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.ico?v=5.1.1" />
















<meta name="description" content="YYModel堪称神级大作，虽然不免一些小bug，但是完全不影响膝盖碎一地。文章主要分享在阅读YYModel源代码时，所引发的知识点的补充与思考。">
<meta name="keywords" content="框架, ios">
<meta property="og:type" content="article">
<meta property="og:title" content="YYModel源代码阅读 - 基础知识">
<meta property="og:url" content="http://localhost:4000/blog/YYModel-reading/">
<meta property="og:site_name" content="Chars's Blog">
<meta property="og:description" content="YYModel堪称神级大作，虽然不免一些小bug，但是完全不影响膝盖碎一地。文章主要分享在阅读YYModel源代码时，所引发的知识点的补充与思考。">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="YYModel源代码阅读 - 基础知识">
<meta name="twitter:description" content="YYModel堪称神级大作，虽然不免一些小bug，但是完全不影响膝盖碎一地。文章主要分享在阅读YYModel源代码时，所引发的知识点的补充与思考。">


<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://localhost:4000/"/>





  <title>YYModel源代码阅读 - 基础知识 | Chars's Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-80507808-1', 'auto');
  ga('send', 'pageview');
</script>





  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=65957271";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>









</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Chars's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">好好学习、天天向上</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

<div id="posts" class="posts-expand">
  
  

  

  
  
  

  <article class="post post-type- " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/blog/YYModel-reading/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chars">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chars's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
          
          
            YYModel源代码阅读 - 基础知识
          
        </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-02-17T04:51:21+08:00">
                2016-02-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/category/#/code" itemprop="url" rel="index">
                    <span itemprop="name">code</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          
            
                <div class="post-description">
                    
                </div>
            
          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
  
  












  <p>YYModel堪称神级大作，虽然不免一些小bug，但是完全不影响膝盖碎一地。文章主要分享在阅读YYModel源代码时，所引发的知识点的补充与思考。</p>

<!-- more -->

<h1 id="前言">前言</h1>
<p>这段时间因为工作需要，阅读了YYModel这个开源框架，至于它能做什么，最直白的讲述就是JSON与Model之间的相互转化。</p>

<p>源代码在<a href="https://github.com/ibireme/YYModel">Github</a>，大家可以自行<code class="highlighter-rouge">git clone</code>或者download。</p>

<p>接下来，笔者主要分析阅读源代码而引出的各种问题与知识点，不足之处请大家指正。</p>

<h1 id="ns_assume_nonnull_begin--ns_assume_nonnull_end">NS_ASSUME_NONNULL_BEGIN &amp; NS_ASSUME_NONNULL_END</h1>

<p>这组宏是成对使用的，不得不说我们自己写代码的时候使用的很少，以至于遗漏这个知识点，现在我们就来看看这两个宏会引出什么问题。</p>

<p>这组宏会引出几个关于Objective-C新特性的知识点：</p>

<ul>
  <li>
    <p>Nullability Annotations</p>
  </li>
  <li>
    <p>Lightweight Generics</p>
  </li>
  <li>
    <p>__kindof</p>
  </li>
</ul>

<h2 id="nullability-annotations">Nullability Annotations</h2>

<p>我们都知道在swift中，可以使用!和?来表示一个对象是optional的还是non-optional，如view?和view!。而在 Objective-C中则没有这一区分，view既可表示这个对象是optional，也可表示是non-optioanl。这样就会造成一个问题：在 Swift与Objective-C混编时，Swift编译器并不知道一个Objective-C对象到底是optional还是non-optional，因此这种情况下编译器会隐式地将Objective-C的对象当成是non-optional。</p>

<p>为了解决这个问题，苹果在Xcode 6.3引入了一个Objective-C的新特性：<strong>nullability annotations</strong>。这一新特性的核心是两个新的类型注释：** __nullable** 和 <strong>__nonnull</strong> 。从字面上我们可以猜到，<code class="highlighter-rouge">__nullable</code>表示对象可以是NULL或nil，而<code class="highlighter-rouge">__nonnull</code>表示对象不应该为空。当我们不遵循这一规则时，编译器就会给出警告。</p>

<p>我们来看看以下的实例，</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12<br/>13</pre></td><td class="code"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">TestNullabilityClass</span> <span class="p">()</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span> <span class="n">NSArray</span> <span class="o">*</span> <span class="n">items</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">itemWithName</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">__nonnull</span><span class="p">)</span><span class="nv">name</span><span class="p">;</span>
<span class="k">@end</span>
<span class="k">@implementation</span> <span class="nc">TestNullabilityClass</span>
<span class="p">...</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">testNullability</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">itemWithName</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>    <span class="c1">// 编译器警告：Null passed to a callee that requires a non-null argument
</span><span class="p">}</span>
<span class="o">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">itemWithName</span><span class="o">:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">__nonnull</span><span class="p">)</span><span class="n">name</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></td></tr></tbody></table></div>
</div>

<p>不过这只是一个警告，程序还是能编译通过并运行。</p>

<p>事实上，在任何可以使用const关键字的地方都可以使用<code class="highlighter-rouge">__nullable</code>和<code class="highlighter-rouge">__nonnull</code>，不过这两个关键字仅限于使用在指针类型上。而在方法的声明中，我们还可以使用不带下划线的<code class="highlighter-rouge">nullable</code>和<code class="highlighter-rouge">nonnull</code>，如下所示：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8</pre></td><td class="code"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="n">nullable</span> <span class="n">id</span><span class="p">)</span><span class="nf">itemWithName</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span> <span class="n">nonnull</span><span class="p">)</span><span class="nv">name</span>
<span class="err">在属性声明中，也增加了两个相应的特性，因此上例中的</span><span class="n">items</span><span class="err">属性可以如下声明：</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="n">nonnull</span><span class="p">)</span> <span class="n">NSArray</span> <span class="o">*</span> <span class="n">items</span><span class="p">;</span>
<span class="err">当然也可以用以下这种方式：</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span> <span class="n">NSArray</span> <span class="o">*</span> <span class="n">__nonnull</span> <span class="n">items</span><span class="p">;</span>
<span class="err">推荐使用</span><span class="n">nonnull</span><span class="err">这种方式，这样可以让属性声明看起来更清晰。</span>
</code></pre></td></tr></tbody></table></div>
</div>

<h3 id="nonnull区域设置audited-regions">Nonnull区域设置(Audited Regions)</h3>

<p>如果需要每个属性或每个方法都去指定<code class="highlighter-rouge">nonnull</code>和<code class="highlighter-rouge">nullable</code>，是一件非常繁琐的事。苹果为了减轻我们的工作量，专门提供了两个宏：<strong>NS_ASSUME_NONNULL_BEGIN</strong>和<strong>NS_ASSUME_NONNULL_END</strong>。在这两个宏之间的代码，所有简单指针对象都被假定为 <code class="highlighter-rouge">nonnull</code>，因此我们只需要去指定那些<code class="highlighter-rouge">nullable</code>的指针。如下代码所示：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6</pre></td><td class="code"><pre class="highlight"><code><span class="n">NS_ASSUME_NONNULL_BEGIN</span>
<span class="k">@interface</span> <span class="nc">TestNullabilityClass</span> <span class="p">()</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span> <span class="n">NSArray</span> <span class="o">*</span> <span class="n">items</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">itemWithName</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">name</span><span class="p">;</span>
<span class="k">@end</span>
<span class="n">NS_ASSUME_NONNULL_END</span>
</code></pre></td></tr></tbody></table></div>
</div>

<p>在上面的代码中，items属性默认是nonnull的，itemWithName:方法的返回值也是nonnull，而参数是指定为nullable的。</p>

<p>不过，为了安全起见，苹果还制定了几条规则：</p>

<ul>
  <li>
    <p>typedef定义的类型的nullability特性通常依赖于上下文，即使是在Audited Regions中，也不能假定它为nonnull。</p>
  </li>
  <li>
    <p>复杂的指针类型(如id *)必须显示去指定是nonnull还是nullable。例如，指定一个指向nullable对象的nonnull指针，可以使用”__nullable id * __nonnull”。</p>
  </li>
  <li>
    <p>我们经常使用的NSError **通常是被假定为一个指向nullable NSError对象的nullable指针。</p>
  </li>
</ul>

<h3 id="兼容性">兼容性</h3>

<p>因为Nullability Annotations是Xcode 6.3新加入的，所以我们需要考虑之前的老代码。实际上，苹果已以帮我们处理好了这种兼容问题，我们可以安全地使用它们：</p>

<ul>
  <li>
    <p>老代码仍然能正常工作，即使对nonnull对象使用了nil也没有问题。</p>
  </li>
  <li>
    <p>老代码在需要和swift混编时，在新的swift编译器下会给出一个警告。</p>
  </li>
  <li>
    <p>nonnull不会影响性能。事实上，我们仍然可以在运行时去判断我们的对象是否为nil。</p>
  </li>
</ul>

<p>事实上，我们可以将nonnull/nullable与我们的断言和异常一起看待，其需要处理的问题都是同一个：违反约定是一个程序员的错误。特别是，返回值是我们可控的东西，如果返回值是nonnull的，则我们不应该返回nil，除非是为了向后兼容。</p>

<h2 id="lightweight-generics">Lightweight Generics</h2>

<p>Lightweight Generics 轻量级泛型，轻量是因为这是个纯编译器的语法支持（LLVM 7.0），和 Nullability 一样，没有借助任何 objc runtime 的升级，也就是说，这个新语法在 Xcode 7 上可以使用且完全向下兼容（更低的 iOS 版本）</p>

<h3 id="带泛型的容器">带泛型的容器</h3>

<p>这无疑是本次最重大的改进，有了泛型后终于可以指定容器类中对象的类型了：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2</pre></td><td class="code"><pre class="highlight"><code>NSArray&lt;NSString *&gt; *strings = @[@"sun", @"yuan"];
NSDictionary&lt;NSString *, NSNumber *&gt; *mapping = @{@"a": @1, @"b": @2};
</code></pre></td></tr></tbody></table></div>
</div>
<p>返回值的 id 被替换成具体的类型后，令人感动的代码提示也出来了。</p>

<p>假如向泛型容器中加入错误的对象，编译器会不开心的。</p>

<p>系统中常用的一系列容器类型都增加了泛型支持，甚至连 <code class="highlighter-rouge">NSEnumerator</code> 都支持了，这是非常 Nice 的改进。和 <code class="highlighter-rouge">Nullability</code> 一样，我认为最大的意义还是丰富了接口描述信息，对比下面两种写法：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2</pre></td><td class="code"><pre class="highlight"><code><span class="k">@property</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span> <span class="n">NSArray</span> <span class="o">*</span><span class="n">imageURLs</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span> <span class="n">NSArray</span><span class="o">&lt;</span><span class="n">NSURL</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="n">imageURLs</span><span class="p">;</span>
</code></pre></td></tr></tbody></table></div>
</div>
<p>不用多想就清楚下面的数组中存的是什么，避免了 <code class="highlighter-rouge">NSString</code> 和 <code class="highlighter-rouge">NSURL</code> 的混乱。</p>

<h3 id="自定义泛型类">自定义泛型类</h3>

<p>比起使用系统的泛型容器，更好玩的是自定义一个泛型类，目前这里还没什么文档，但拦不住我们写测试代码，假设我们要自定义一个 Stack 容器类：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5</pre></td><td class="code"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">Stack</span><span class="o">&lt;</span><span class="n">ObjectType</span><span class="o">&gt;</span> <span class="o">:</span> <span class="n">NSObject</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">pushObject</span><span class="o">:</span><span class="p">(</span><span class="n">ObjectType</span><span class="p">)</span><span class="n">object</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">ObjectType</span><span class="p">)</span><span class="n">popObject</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">NSArray</span><span class="o">&lt;</span><span class="n">ObjectType</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">allObjects</span><span class="p">;</span>
<span class="k">@end</span>
</code></pre></td></tr></tbody></table></div>
</div>
<p>这个 <code class="highlighter-rouge">ObjectType</code> 是传入类型的 <code class="highlighter-rouge">placeholder</code>，它只能在 <code class="highlighter-rouge">@interface</code> 上定义（类声明、类扩展、Category），如果你喜欢用 T 表示也 OK，这个类型在 <code class="highlighter-rouge">@interface</code> 和 <code class="highlighter-rouge"><span class="k">@end</span></code> 区间的作用域有效，可以把它作为入参、出参、甚至内部 NSArray 属性的泛型类型，应该说一切都是符合预期的。我们还可以给 ObjectType 增加类型限制，比如：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4</pre></td><td class="code"><pre class="highlight"><code>// 只接受 NSNumber * 的泛型
@interface Stack&lt;ObjectType: NSNumber *&gt; : NSObject
// 只接受满足 NSCopying 协议的泛型
@interface Stack&lt;ObjectType: id&lt;NSCopying&gt;&gt; : NSObject
</code></pre></td></tr></tbody></table></div>
</div>
<p>若什么都不加，表示接受任意类型 ( id )；当类型不满足时编译器将产生 error。
实例化一个 Stack，一切工作正常：</p>

<p>对于多参数的泛型，用逗号隔开，其他都一样，可以参考 NSDictionary 的头文件。</p>

<h3 id="协变性和逆变性">协变性和逆变性</h3>

<p>当类支持泛型后，它们的 Type 发生了变化，比如下面三个对象看上去都是 Stack，但实际上属于三个 Type：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3</pre></td><td class="code"><pre class="highlight"><code>Stack *stack; // Stack *
Stack&lt;NSString *&gt; *stringStack; // Stack&lt;NSString *&gt;
Stack&lt;NSMutableString *&gt; *mutableStringStack; // Stack&lt;NSMutableString *&gt;
</code></pre></td></tr></tbody></table></div>
</div>
<p>当其中两种类型做类型转化时，编译器需要知道哪些转化是允许的，哪些是禁止的，比如，默认情况下：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10</pre></td><td class="code"><pre class="highlight"><code>Stack *stack;
Stack&lt;NSString *&gt; *stringStack;
Stack&lt;NSMutableString *&gt; *mutableStringStack; 

stack = stringStack;
stack = mutableStringStack;
stringStack = stack;
stringStack = mutableStringStack;
mutableStringStack = stack;
mutableStringStack = stringStack
</code></pre></td></tr></tbody></table></div>
</div>
<p>在Xcode中我们可以看到，不指定泛型类型的 Stack 可以和任意泛型类型转化，但指定了泛型类型后，两个不同类型间是不可以强转的，假如你希望主动控制转化关系，就需要使用泛型的协变性和逆变性修饰符了：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2</pre></td><td class="code"><pre class="highlight"><code>__covariant - 协变性，子类型可以强转到父类型（里氏替换原则）
__contravariant - 逆变性，父类型可以强转到子类型（WTF）
</code></pre></td></tr></tbody></table></div>
</div>

<h4 id="协变">协变</h4>
<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1</pre></td><td class="code"><pre class="highlight"><code>@interface Stack&lt;__covariant ObjectType&gt; : NSObject
</code></pre></td></tr></tbody></table></div>
</div>

<h4 id="逆变">逆变</h4>
<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1</pre></td><td class="code"><pre class="highlight"><code>@interface Stack&lt;__contravariant ObjectType&gt; : NSObject
</code></pre></td></tr></tbody></table></div>
</div>

<p>协变是非常好理解的，像 <code class="highlighter-rouge">NSArray</code> 的泛型就用了协变的修饰符。</p>

<h2 id="__kindof">__kindof</h2>

<p><code class="highlighter-rouge">__kindof</code> 这修饰符还是很实用的，解决了一个长期以来的小痛点，拿原来的 <code class="highlighter-rouge">UITableView</code> 的这个方法来说：</p>
<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1</pre></td><td class="code"><pre class="highlight"><code>- (id)dequeueReusableCellWithIdentifier:(NSString *)identifier;
</code></pre></td></tr></tbody></table></div>
</div>
<p>使用时前面基本会使用 <code class="highlighter-rouge">UITableViewCell</code> 子类型的指针来接收返回值，所以这个 API 为了让开发者不必每次都蛋疼的写显式强转，把返回值定义成了 id 类型，而这个 API 实际上的意思是返回一个 <code class="highlighter-rouge">UITableViewCell</code> 或 <code class="highlighter-rouge">UITableViewCell</code> 子类的实例，于是新的 <code class="highlighter-rouge">__kindof</code> 关键字解决了这个问题：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1</pre></td><td class="code"><pre class="highlight"><code>- (__kindof UITableViewCell *)dequeueReusableCellWithIdentifier:(NSString *)identifier;
</code></pre></td></tr></tbody></table></div>
</div>

<p>既明确表明了返回值，又让使用者不必写强转。再举个带泛型的例子，UIView 的 subviews 属性被修改成了：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1</pre></td><td class="code"><pre class="highlight"><code><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span> <span class="n">NSArray</span><span class="o">&lt;</span><span class="n">__kindof</span> <span class="n">UIView</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="n">subviews</span><span class="p">;</span>
</code></pre></td></tr></tbody></table></div>
</div>

<p>这样，写下面的代码时就没有任何警告了：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1</pre></td><td class="code"><pre class="highlight"><code>UIButton *button = view.subviews.lastObject;
</code></pre></td></tr></tbody></table></div>
</div>

<h1 id="ns_enum--ns_options">NS_ENUM &amp; NS_OPTIONS</h1>

<p>枚举是指将变量的值一一列举出来，变量的值只限于列举出来的值的范围内。</p>

<p>枚举本质上是一个整数，枚举的作用是把值限定在指定的范围内，并且增加代码的可读性。 枚举的成员如果没有显示指定值，那么第一个成员的值总是0，后面成员的值依次递增。枚举可以直接用于比较。</p>

<p>一般我们声明枚举：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9</pre></td><td class="code"><pre class="highlight"><code>#import &lt;Foundation/Foundation.h&gt;

// 声明枚举类型
enum Direction {up, down, left = 10, right};

int main(int argc, const char * argv[]){
  ...
}
其中up = 0, down = 1, left = 10, right = 11。
</code></pre></td></tr></tbody></table></div>
</div>

<p>我们会发现枚举中一些不可自定义的部分，例如，枚举名。</p>

<p>NS_ENUM 和 NS_OPTIONS 都不算太古老的宏，在iOS 6 / OS X Mountain Lion才开始有，它们都是代替 enum 的更好的办法。</p>

<h2 id="ns_enum">NS_ENUM</h2>

<p>如果要在早期的iOS或OS X系统中使用这两个宏，简单定义一下就好</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3</pre></td><td class="code"><pre class="highlight"><code>#ifndef NS_ENUM
#define NS_ENUM(_type, _name) enum _name : _type _name; enum _name : _type
#endif
</code></pre></td></tr></tbody></table></div>
</div>
<p>在OS X 10.4 中的原始定义如下：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2</pre></td><td class="code"><pre class="highlight"><code>#define NS_ENUM(_type, _name) CF_ENUM(_type, _name)
#define NS_OPTIONS(_type, _name) CF_OPTIONS(_type, _name)
</code></pre></td></tr></tbody></table></div>
</div>
<p>在之前枚举可以这么定义：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6</pre></td><td class="code"><pre class="highlight"><code>typedef enum {
    UITableViewCellStyleDefault,
    UITableViewCellStyleValue1,
    UITableViewCellStyleValue2,
    UITableViewCellStyleSubtitle
};
</code></pre></td></tr></tbody></table></div>
</div>

<p>或者</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1</pre></td><td class="code"><pre class="highlight"><code>typedef NSInteger UITableViewCellStyle;
</code></pre></td></tr></tbody></table></div>
</div>

<p>现在，有了统一的风格</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6</pre></td><td class="code"><pre class="highlight"><code>typedef NS_ENUM(NSInteger, UITableViewCellSelectionStyle) {
    UITableViewCellSelectionStyleNone,
    UITableViewCellSelectionStyleBlue,
    UITableViewCellSelectionStyleGray,
    UITableViewCellSelectionStyleDefault
};
</code></pre></td></tr></tbody></table></div>
</div>

<p><code class="highlighter-rouge">NS_ENUM</code> 的第一个参数是用于存储的新类型的类型。在64位环境下，<code class="highlighter-rouge">UITableViewCellStyle</code> 和 <code class="highlighter-rouge">NSInteger</code> 一样有8 bytes长。你要保证你给出的所有值能被该类型容纳，否则就会产生错误。第二个参数是新类型的名字。大括号里面和以前一样，是你要定义的各种值。</p>

<h2 id="ns_options">NS_OPTIONS</h2>

<table>
  <tbody>
    <tr>
      <td>语法和 <code class="highlighter-rouge">NS_ENUM</code> 完全相同，但这个宏提示编译器值是如何通过位掩码</td>
      <td>组合在一起的。</td>
    </tr>
  </tbody>
</table>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6</pre></td><td class="code"><pre class="highlight"><code>typedef NS_OPTIONS(NSUInteger, AMGResizing) {
    AMGResizingNone            = 0,
    AMGResizingFlexibleWidth   = 1 &lt;&lt; 0,
    AMGResizingFlexibleHeight  = 1 &lt;&lt; 1,
    AMGResizingFlexibleUnicorn = 1 &lt;&lt; 2
};
</code></pre></td></tr></tbody></table></div>
</div>

<h1 id="attributealways_inline"><strong>attribute</strong>((always_inline))</h1>

<p>我们知道一般的函数调用都会通过call的方式来调用，这样让攻击很容易对一个函数做手脚，如果是以<code class="highlighter-rouge">inline</code>的方式编译的会，会把该函数的code拷贝到每次调用该函数的地方。而<code class="highlighter-rouge">static</code>会让生成的二进制文件中没有清晰的符号表，让逆向的人很难弄清楚逻辑。</p>

<p><code class="highlighter-rouge">__attribute__((always_inline))</code> 的意思是强制内联，所有加了<code class="highlighter-rouge">__attribute__((always_inline))</code> 的函数再被调用时不会被编译成函数调用而是直接扩展到调用函数体内，比如定义了函数
<code class="highlighter-rouge">__attribute__((always_inline)) void a()</code>
和</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3</pre></td><td class="code"><pre class="highlight"><code>void b()｛  
    a();
｝
</code></pre></td></tr></tbody></table></div>
</div>

<p>b 调用 a 函数的汇编代码不会是跳转到a执行，而是 a 函数的代码直接在 b 内成为 b 的一部分。
<code class="highlighter-rouge">#define __inline __attribute__((always_inline))</code> 的意思就是用
<code class="highlighter-rouge">__inline</code> 代替<code class="highlighter-rouge">__attribute__((always_inline))</code>
内声明a的时候可以直接写成<code class="highlighter-rouge">__inline void a()</code> 这样比较方便因为<code class="highlighter-rouge">__attribute__((always_inline))</code> 字多。</p>

<h1 id="undef">undef</h1>

<p>这是预编译指令，和<code class="highlighter-rouge">#define</code>搭配使用，意思是取消之前的宏定义。</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5<br/>6<br/>7<br/>8<br/>9<br/>10<br/>11<br/>12</pre></td><td class="code"><pre class="highlight"><code>#define PROC_ADD 
void main(void) 
{
#ifdef PROC_ADD 
// Do this code here then undefined it to run the code in the else 
// processing work 
#undef PROC_ADD 
#else 
// now that PROC_ADD has been undefined run this code 
// processing work 
#endif 
}
</code></pre></td></tr></tbody></table></div>
</div>

<h1 id="__unsafe_unretained">__unsafe_unretained</h1>

<p><code class="highlighter-rouge">__unsafe_unretained</code>是对对象的非zeroing的weak reference，意思是当对象所指向的内存被销毁了，对象还存在，称为“野指针”。</p>

<p>在iOS引入了Automatic Reference Count（ARC）之后，编译器可以在编译时对obj-c对象进行内存管理。大致规则如下：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="margin: 0px"><tbody><tr><td class="gutter"><pre>1<br/>2<br/>3<br/>4<br/>5</pre></td><td class="code"><pre class="highlight"><code>alloc的要release;
retain/copy的要release;
NSAutoreleasePool在ARC中被禁止使用,替换成@autoreleasepool 函数体;
使用@ autoreleasepool,在函数入口的时候,autorelease pool入栈,正常退出时,autorelease pool出栈,从而释放变量.
注意:@ autoreleasepool在非ARC模式下,也能使用,并据说使用@autoreleasepool比使用NSAutoreleasePool速度能快6倍, 明显提升程序性能.
</code></pre></td></tr></tbody></table></div>
</div>

<h1 id="package">@package</h1>

<p>为了强制一个对象隐藏其数据，编译器限制实例变量范围以限制其在程序中的可见性，但是为了提供灵活性，苹果也让开发者显式设置范围。</p>

<p>以下是这些关键字的使用范围：</p>

<ul>
  <li>@private</li>
</ul>

<p>The instance variable is accessible only within the class that declares it.</p>

<p>实例变量只能被声明它的类访问.</p>

<ul>
  <li>@protected</li>
</ul>

<p>The instance variable is accessible within the class that declares it and within classes that inherit it. All instance variables without an explicit scope directive have @protected scope.</p>

<p>实例变量能被声明它的类和子类访问，所有没有显式制定范围的实例变量都是.</p>

<ul>
  <li>@public</li>
</ul>

<p>The instance variable is accessible everywhere.</p>

<p>实例变量可以被在任何地方访问.</p>

<ul>
  <li>@package</li>
</ul>

<p>Using the modern runtime, an <code class="highlighter-rouge">@package</code> instance variable has <code class="highlighter-rouge">@public</code> scope inside the executable image that implements the class, but acts like <code class="highlighter-rouge">@private</code> outside.使用modern运行时，一个<code class="highlighter-rouge">@package</code>实例变量在实现这个类的可执行文件镜像中实际上是<code class="highlighter-rouge">@public</code>的，但是在外面就是<code class="highlighter-rouge">@private</code>【runtime需要再看一下苹果文档Runtime Programming Guide】</p>

<p>The <code class="highlighter-rouge">@package</code> scope for Objective-C instance variables is analogous to private_extern for C variables and functions. Any code outside the class implementation’s image that tries to use the instance variable gets a link error.</p>

<p>Objective-C中的<code class="highlighter-rouge">@package</code>与C语言中变量和函数的private_extern类似。任何在实现类的镜像之外的代码想使用这个实例变量都会引发link error</p>

<p>This scope is most useful for instance variables in framework classes, where <code class="highlighter-rouge">@private</code> may be too restrictive but <code class="highlighter-rouge">@protected</code> or <code class="highlighter-rouge">@public</code> too permissive.</p>

<table>
  <tbody>
    <tr>
      <td>这个类型最常用于框架类的实例变量，使用<code class="highlighter-rouge">@private</code>太限制，使用<code class="highlighter-rouge">@protected</code>或者<code class="highlighter-rouge">@public</code>又太开放.</td>
    </tr>
  </tbody>
</table>



      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            
            <a href="/tag/#/%E6%A1%86%E6%9E%B6" rel="tag"># 框架</a>
          
            
            <a href="/tag/#/ios" rel="tag"># ios</a>
          
        </div>
      

      
      
      
      
      

      
      
        <div class="post-nav" id="post-nav-id">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blog/objc-new-alloc-init/" rel="next" title="Objective-C 中 new、alloc和init的区别">
                <i class="fa fa-chevron-left"></i> Objective-C 中 new、alloc和init的区别
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/blog/memory-alignment/" rel="prev" title="内存对齐详解">
                内存对齐详解 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      
      

      
    </footer>
  </article>

  <div class="post-spread">
    
  </div>
</div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMzY4My8xMDIzOA=="></div>
    
  </div>


        </div>
        
          

  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        
        
        







      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/assets/images/avatar.jpg"
               alt="Chars" />
          <p class="site-author-name" itemprop="name">Chars</p>
           
              <p class="site-description motion-element" itemprop="description"><p>哈喽，我是 <a href="https://twitter.com/charsdavy">@Chars</a>，是一名来自中国的 iOS 开发者。</p> <p>业余时间参加 <a href="https://github.com/xitu/gold-miner">掘金翻译计划</a>，撰写知乎专栏<a href="https://zhuanlan.zhihu.com/easy-to-understand-algorithm">《通俗易懂的算法》</a>、<a href="https://zhuanlan.zhihu.com/health-go">《如何独立开发一个完整应用》</a></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">97</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/">
                <span class="site-state-item-count">52</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
        
        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              
              
              <span class="links-of-author-item">
                <a href="https://github.com/charsdavy" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              
              
              <span class="links-of-author-item">
                <a href="https://www.twitter.com/charsdavy" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              
              
              <span class="links-of-author-item">
                <a href="https://weibo.com/u/3875245858" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              
              
              <span class="links-of-author-item">
                <a href="https://instagram.com/chars.davy" target="_blank" title="Instagram">
                  
                    <i class="fa fa-fw fa-instagram"></i>
                  
                  Instagram
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            








            
              <div class="post-toc-content">
    <ol class=nav>
      <li class="nav-item nav-level-1"> <a class="nav-link" href="#前言"> <span class="nav-number">1</span> <span class="nav-text">前言</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#ns_assume_nonnull_begin--ns_assume_nonnull_end"> <span class="nav-number">2</span> <span class="nav-text">NS_ASSUME_NONNULL_BEGIN &amp; NS_ASSUME_NONNULL_END</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-2"> <a class="nav-link" href="#nullability-annotations"> <span class="nav-number">2.1</span> <span class="nav-text">Nullability Annotations</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#nonnull区域设置audited-regions"> <span class="nav-number">2.1.1</span> <span class="nav-text">Nonnull区域设置(Audited Regions)</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#兼容性"> <span class="nav-number">2.1.2</span> <span class="nav-text">兼容性</span> </a> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#lightweight-generics"> <span class="nav-number">2.2</span> <span class="nav-text">Lightweight Generics</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#带泛型的容器"> <span class="nav-number">2.2.1</span> <span class="nav-text">带泛型的容器</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#自定义泛型类"> <span class="nav-number">2.2.2</span> <span class="nav-text">自定义泛型类</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#协变性和逆变性"> <span class="nav-number">2.2.3</span> <span class="nav-text">协变性和逆变性</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-4"> <a class="nav-link" href="#协变"> <span class="nav-number">2.2.3.1</span> <span class="nav-text">协变</span> </a> </li> <li class="nav-item nav-level-4"> <a class="nav-link" href="#逆变"> <span class="nav-number">2.2.3.2</span> <span class="nav-text">逆变</span> </a> </li> </ol> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#__kindof"> <span class="nav-number">2.3</span> <span class="nav-text">__kindof</span> </a> </li> </ol> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#ns_enum--ns_options"> <span class="nav-number">3</span> <span class="nav-text">NS_ENUM &amp; NS_OPTIONS</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-2"> <a class="nav-link" href="#ns_enum"> <span class="nav-number">3.1</span> <span class="nav-text">NS_ENUM</span> </a> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#ns_options"> <span class="nav-number">3.2</span> <span class="nav-text">NS_OPTIONS</span> </a> </li> </ol> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#attributealways_inline"> <span class="nav-number">4</span> <span class="nav-text">attribute((always_inline))</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#undef"> <span class="nav-number">5</span> <span class="nav-text">undef</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#__unsafe_unretained"> <span class="nav-number">6</span> <span class="nav-text">__unsafe_unretained</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#package"> <span class="nav-number">7</span> <span class="nav-text">@package</span> </a> </li>
    </ol>
  </div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>

        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-leaf"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chars</span>
</div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





















  
   
  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery/index.js?v=2.1.3"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/assets/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/assets/js/src/motion.js?v=5.1.1"></script>



  
  

  <script type="text/javascript" src="/assets/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/assets/js/src/post-details.js?v=5.1.1"></script>


  


  <script type="text/javascript" src="/assets/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  











  




  

    
      <script type="text/javascript">
        (function(d, s) {
          var j, e = d.getElementsByTagName(s)[0];
          if (typeof LivereTower === 'function') { return; }
          j = d.createElement(s);
          j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
          j.async = true;
          e.parentNode.insertBefore(j, e);
        })(document, 'script');
      </script>
    

  





  






  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  


  

  

  

</body>
</html>

