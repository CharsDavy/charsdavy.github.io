<!DOCTYPE HTML>
<!--
	Massively by HTML5 UP
	html5up.net | @ajlkn
  Jekyll integration by somiibo.com
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
--><html>
	<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<title>Xcode插件开发教程指南</title>
<meta name="description" content="">

<link rel="apple-touch-icon" sizes="180x180" href="/assets/icon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/icon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/icon/favicon-16x16.png">
<link rel="manifest" href="/assets/icon/manifest.json">
<link rel="mask-icon" href="/assets/icon/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/icon/favicon.ico">
<meta name="msapplication-config" content="/assets/icon/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- CSS -->
<link rel="stylesheet" href="/assets/css/main.css">
<noscript><link rel="stylesheet" href="/assets/css/noscript.css"></noscript>

	</head>
	<body class="is-loading">

		<!-- Wrapper -->
			<div id="wrapper" class="fade-in">

				<!-- Header -->
        <header id="header">
          <a href="/" class="logo">Chars's Tech Blog</a>
        </header>

				<!-- Nav -->
					<nav id="nav">

            <ul class="links">
  <li class=""><a href="/">Home</a></li>
  <li class=" active "><a href="/blog/">Blog</a></li>
  <li class=""><a href="/tags/">Tags</a></li>
  <li class=""><a href="/categories/">Categories</a></li>
  <li class=""><a href="/about/">About</a></li>
<!--   <li class=""><a href="/elements/">Elements Reference</a></li> -->
</ul>


						<ul class="icons">
              <li><a href="https://twitter.com/charsdavy" class="icon fa-twitter" rel="nofollow"><span class="label">Twitter</span></a></li>
              <li><a href="https://facebook.com/wei.deng.1460" class="icon fa-facebook" rel="nofollow"><span class="label">Facebook</span></a></li>
              <li><a href="https://instagram.com/chars.davy" class="icon fa-instagram" rel="nofollow"><span class="label">Instagram</span></a></li>
              <li><a href="https://github.com/charsdavy" class="icon fa-github" rel="nofollow"><span class="label">GitHub</span></a></li>
						</ul>
					</nav>

				<!-- Main -->
				<div id="main">
          <section class="post">
    				<header class="major">
      				<span class="date">26 Mar 2016</span>
      				<h1>Xcode插件开发教程指南</h1>
      				<p></p>
<p>对于Xcode而言，我们苹果开发者并不陌生，对于Xcode的插件，我们也不陌生。但是，有几个人做过Xcode插件呢？！Who care？显然，博主是关心的，这里分享一下博主自己开发插件的过程。</p>


      			</header>
      			<div class="image main"><img src="" alt=""></div>
      			<p></p>
<p>对于Xcode而言，我们苹果开发者并不陌生，对于Xcode的插件，我们也不陌生。但是，有几个人做过Xcode插件呢？！Who care？显然，博主是关心的，这里分享一下博主自己开发插件的过程。</p>

<p>在平时开发过程中我们使用了很多的Xcode插件，虽然官方对于插件制作没有提供任何支持，但是加载三方的插件，默认还是被允许的。第三方的插件，存放在 <code class="highlighter-rouge">~/Library/Application Support/Developer/Shared/Xcode/Plug-ins</code>文件夹中，后缀名必须是<code class="highlighter-rouge">.xcplugin</code> ，其实际上是一种bundle。所以我们创建一个插件工程，直接创建bundle工程即可。然后通过修改后缀名为<code class="highlighter-rouge">.xcplugin</code>，将其放到<code class="highlighter-rouge">~/Library/Application Support/Developer/Shared/Xcode/Plug-ins</code>目录中即可。</p>

<p>Xcode插件开发现在主要通过两种方式实现，其实也就是一种，只不过其中一种是使用别人提供的开发模板来省去很多中间步骤而已。文章会依次详细介绍两种的实现方法。</p>
<h1 id="准备工作">准备工作</h1>
<h2 id="方式一通过bundle实现">方式一：通过Bundle实现</h2>
<p>1.创建Bundle工程</p>

<p><a href="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330144728207-192574452.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-8badd5c1eaccb38b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>

<p>2.工程设置</p>

<p>插件工程和普通的bundle工程还是有区别的,所以需要进行特殊的设置。</p>

<p>1）工程的plist文件</p>

<p><a href="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330144905629-871612988.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-fd793ba30c7f7fca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>

<p>添加三项：</p>

<p>XCPluginHasUI = NO</p>

<p>XC4Compatible = YES</p>

<p>DVTPlugInCompatibilityUUIDs 这是一个数组。数组内容字符串，指示了该插件兼容的Xcode版本，只有对应版本的Xcode的UIID加入这个数组，插件才能被加载。</p>

<p>否则，即使将插件放入Xcode的插件文件夹，插件也不会被加载。获取当前版本的Xcode的UUID方式：</p>

<p>在terminal中输入命令：</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>defaults read /Applications/Xcode.app/Contents/Info DVTPlugInCompatibilityUUID
</code></pre>
</div>

<p>terminal会返回一串字符串，这就是Xcode的DVTPlugInCompatibilityUUID。</p>

<p>2）Build Setting</p>

<p><a href="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330145158129-342161810.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-44a2d20adddc97ef.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>

<p><a href="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330145210144-303815379.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-2dd7603d97b0b42f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>

<p>Installation Build Products Location 设置为 ${HOME} [显示的时候,显示的是你的用户目录]，这个是products的根目录。</p>

<p>Installation Directory 设置为 /Library/Application Support/Developer/Shared/Xcode/Plug-ins，这个是指定你的插件安装的目录。</p>

<p><strong>注意，这里填入的其实是相对目录。</strong></p>

<p>插件的绝对目录是这样的，例如 /Users/yohunl/Library/Application\ Support/Developer/Shared/Xcode/Plug-ins/Alcatraz.xcplugin ，最后的绝对目录是 Installation Build Products Location和Installation Directory的结合，这也是为什么两者都要设置的原因。</p>

<p>Deployment Location 设置为 YES，这个是指示该工程不使用设置里的build location，而是用Installation Directory来确定build后放置的位置。</p>

<p><a href="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330145434019-1733725866.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-9c41ca195b3ba670.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>

<p>默认工程生成的相关文件位置都是 Build Locations指定的，通过Deployment Location 设置为 YES告诉工程，我们不使用这个默认的设置，而是我们自定义的。</p>

<p>Wrapper extension 设置为 xcplugin，后缀名必须为xcplugin，否则不会被加载。</p>

<h2 id="方式二通过模板实现">方式二：通过模板实现</h2>
<p>1）下载Xcode插件开发模板</p>

<p>地址：<a href="https://github.com/kattrali/Xcode-Plugin-Template">https://github.com/kattrali/Xcode-Plugin-Template</a></p>

<p>2）将下载下来的template复制到 ~/Library/Developer/Xcode/Templates/Project Templates/Application Plug-in/Xcode Plugin.xctemplate文件夹中，如果没有对应的文件夹就自己手动创建一个。</p>

<p>3）重启Xcode，当你新建一个工程的时候就可以在OS X中看到一个Application Plug-in的选项，里面有一个Xcode Plug-in模板。</p>

<p><a href="http://images2015.cnblogs.com/blog/490781/201603/490781-20160330150045894-1159966575.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-12e203138789f666.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>

<h1 id="实现">实现</h1>
<p>通过以上的两种准备方式，我们已可以创建Xcode插件工程，接下来就是如何实现插件功能。</p>

<p>1.功能需求
在当前选中文件中实现代码风格重构，目前主要实现setter方法这一风格重构。例如，</p>

<p><code class="highlighter-rouge">[self setName:@"Davy"];</code> ==&gt; <code class="highlighter-rouge">self.name = @"Davy";</code></p>

<p>2.思路分析</p>

<p>1）找到当前文件中符合setter方法命名风格的方法调用。</p>

<p>2）替换找到的符合重构风格的代码，提醒用户保存。</p>

<p>3.技术难点</p>

<p>1）Xcode代码编辑框文件内容操作。</p>

<p>2）正则表达式书写。</p>

<p>3）Xcode代码编辑框提醒用户保存文件。</p>

<p>关于最后一点，因为Xcode对于没有保存的已修改过的文件会显灰以提示用户该文件需要保存，我们可以借鉴这种方式。另外，在查找时，如果能够实现高亮并且跟随滚动，效果会更佳。</p>

<p>4.关键代码</p>

<p>以上这些问题，本人在“Refactor Code”插件中全部实现，现在放上关键方法。</p>

<p>1）添加菜单</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>-(void) setupMenuItem {
    // Menu Item:
    NSMenuItem *editMenuItem = [[NSApp mainMenu] itemWithTitle:@"Edit"];
    if (editMenuItem) {
        [[editMenuItem submenu] addItem:[NSMenuItem separatorItem]];
        NSMenu *refactorCodeMenu = [[NSMenu alloc] initWithTitle:@"Refactor Code"];
        NSMenuItem *menuItem;
        menuItem = [[NSMenuItem alloc] initWithTitle:@"Refactor Method Style" action:@selector(refactorMethodStyleMenuAction) keyEquivalent:@""];
        [menuItem setTarget:self]; [refactorCodeMenu addItem:menuItem];
        NSMenuItem *refactorCodeMenuItem = [[NSMenuItem alloc] initWithTitle:@"Refactor Code" action:nil keyEquivalent:@""];
        [refactorCodeMenuItem setSubmenu:refactorCodeMenu];
        [[editMenuItem submenu] addItem:refactorCodeMenuItem];
    }
}
</code></pre>
</div>

<p>效果图如下：</p>

<p><a href="http://images2015.cnblogs.com/blog/490781/201604/490781-20160401135707035-2105407027.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-255646a7f96b5d6f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>

<p>2）显示操作面板</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>- (void)refactorMethodStyleMenuAction {
    [self.operateController showWindow:nil];
    NSURL *url = [[NSBundle bundleForClass:[self class]] URLForResource:@"DZOperateController" withExtension:@"nib"];
    if (!url) {
        NSAlert *alert = [[NSAlert alloc] init];
        alert.messageText = @"Refactor Method Style could not be shown because the plugin is corrupted.";
        alert.informativeText = @"If you build the plugin from sources using Xcode, make sure to perform “Clean Build Folder“ in　　　　　　　　Xcode and then build the plugin again.\n\nIf you installed the plugin via Alctraz, there is a pending issue causing　　　　　　　　some files to be missing in the plugin. Prefer to install it via the plugin webpage.";
        [alert addButtonWithTitle:@"Download Latest"];
        [alert addButtonWithTitle:@"Cancel"];
        NSModalResponse result = [alert runModal];
        if (result == NSAlertFirstButtonReturn) {
            [[NSWorkspace sharedWorkspace] openURL:[NSURL URLWithString:@"https://github.com/CharsDavy/RefactorCodePlugin-Xcode"]];
        }
    }
}
</code></pre>
</div>
<p>效果图如下：</p>

<p><a href="http://images2015.cnblogs.com/blog/490781/201604/490781-20160401135950379-1172628646.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-f71208a60c0568c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>

<p>3）查找替换代码风格</p>

<p>这一部分是重点部分，包括如何书写正则表达式，并且利用正则表达式生成替换字符。还包括高亮代码，具体可以参见本人源码：<a href="https://github.com/CharsDavy/RefactorCodePlugin-Xcode">https://github.com/CharsDavy/RefactorCodePlugin-Xcode</a></p>

<p>4）最终效果图</p>

<p><a href="http://images2015.cnblogs.com/blog/490781/201604/490781-20160401140322598-323202767.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-c5cd468f1b7f4332.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>

<h1 id="提交插件至alcatraz">提交插件至Alcatraz</h1>
<p>1.打开Alcatraz的插件包仓库，地址：<a href="https://github.com/supermarin/alcatraz-packages">https://github.com/supermarin/alcatraz-packages</a></p>

<p>2.在简介里可以看到Alcatraz的包分为三类，分别为：插件(plugins)，配色方案(color schemes)和模板(templates)。每个包都必须包含”name”、”url”和”description”字段，还有一个可选的”screenshot”字段。</p>

<p>3.Fork这个仓库，再克隆到本地。</p>

<p>4.以添加”Refactor Code”插件为例，打开packages.json文件，在”plugins”数组里加入：</p>

<div class="highlighter-rouge">
<pre class="highlight"><code><span class="p">{</span><span class="w"> 
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Refactor Code"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/CharsDavy/RefactorCodePlugin-Xcode.git"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Refactor code style,such as setter method."</span><span class="p">,</span><span class="w">
  </span><span class="nt">"screenshot"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/CharsDavy/RefactorCodePlugin-Xcode/raw/master/Screenshots/window.png"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<p>5.提交代码到Fork的地址，再提交一个pull request到Master即可。</p>

<p>6.merged成功之后，即可看见以下效果图</p>

<p><a href="http://images2015.cnblogs.com/blog/490781/201604/490781-20160401092906176-1572332699.png"><img src="http://upload-images.jianshu.io/upload_images/1492739-1a1146bc89c01d63.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></a></p>

<p>希望对大家有所帮助。</p>

      		</section>

          <div class="comments-wrapper">
          <!--
          <div id="disqus_thread"></div>
          <script>
              /**
               *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
               *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
               */

              var disqus_config = function () {
                  this.page.url = '/blog/xcode-plugin-develop/';  /*Replace PAGE_URL with your page's canonical URL variable*/
                  this.page.identifier = '/blog/xcode-plugin-develop/'; /*Replace PAGE_IDENTIFIER with your page's unique identifier variable*/
              };

              (function() {  /* dont endit below this line */
                  var d = document, s = d.createElement('script');

                  s.src = 'https://.disqus.com/embed.js';

                  s.setAttribute('data-timestamp', +new Date());
                  (d.head || d.body).appendChild(s);
              })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>-->

          <!-- 来必力City版安装代码 -->
          <div id="lv-container" data-id="city" data-uid="MTAyMC8zMzY4My8xMDIzOA==">
          <script type="text/javascript">
             (function(d, s) {
                 var j, e = d.getElementsByTagName(s)[0];

                 if (typeof LivereTower === 'function') { return; }

                 j = d.createElement(s);
                 j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
                 j.async = true;

                 e.parentNode.insertBefore(j, e);
             })(document, 'script');
          </script>
          <noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
          </div>
        </div>
        <!-- /.comments-wrapper -->



					<!-- Footer -->
						<footer>
              <ul class="actions">
                <li><a href="/blog/" class="button">All Blog</a></li>
              </ul>
						</footer>
					</div>

				<!-- Footer -->
        <footer id="footer">
  <section>
    <form method="POST" action="https://formspree.io/chars.davy@gmail.com">
      <div class="field">
        <label for="name">Name</label>
        <input type="text" name="name" id="name">
      </div>
      <div class="field">
        <label for="email">Email</label>
        <input type="text" name="email" id="email">
      </div>
      <div class="field">
        <label for="message">Message</label>
        <textarea name="message" id="message" rows="3"></textarea>
      </div>
      <ul class="actions">
        <li><input type="submit" value="Send Message"></li>
      </ul>
    </form>
  </section>
  <section class="split contact">
    <section class="alt">
      <h3>Location</h3>
      <p>Guangzhou, China</p>
    </section>
    <section>
      <h3>QQ</h3>
      <p><a href="qq:124808738">124808738</a></p>
    </section>
    <section>
      <h3>Email</h3>
      <p><a href="mailto:chars.davy@gmail.com">chars.davy@gmail.com</a></p>
    </section>
    <section>
      <h3>Social</h3>
      <ul class="icons alt">
        <li><a href="https://twitter.com/charsdavy" class="icon fa-twitter" rel="nofollow"><span class="label">Twitter</span></a></li>
        <li><a href="https://facebook.com/wei.deng.1460" class="icon fa-facebook" rel="nofollow"><span class="label">Facebook</span></a></li>
        <li><a href="https://instagram.com/chars.davy" class="icon fa-instagram" rel="nofollow"><span class="label">Instagram</span></a></li>
        <li><a href="https://github.com/charsdavy" class="icon fa-github" rel="nofollow"><span class="label">GitHub</span></a></li>
      </ul>
    </section>
  </section>
</footer>
<div id="back-top" style="position:fixed;bottom:40px;right:30px;cursor: pointer;">
  <a href="#top" title="返回顶部"><img src="/images/arrow-up.png"></a>
</div>
<script type="text/javascript">
  $("#back-top").hide();
  $(document).ready(function () {
    $(window).scroll(function () {
      if ($(this).scrollTop() > 800) {
        $('#back-top').fadeIn();
      } else {
        $('#back-top').fadeOut();
      }
    });
    $('#back-top a').click(function () {
      $('body,html').animate({
        scrollTop: 0
      }, 1200);
      return false;
    });
  });
</script>
<!-- Copyright -->
<div id="copyright">
  <ul>
<li>2016 - 2018 © Chars</li>
<li>Design by <a href="https://html5up.net" rel="nofollow">HTML5 UP</a>
</li>
<li>Jekyll Integration by <a href="https://soundgrail.com">SoundGrail</a>
</li>
</ul>
</div>


			</div>

      <!-- Scripts -->
  		<!-- DYN -->
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/jquery.scrollex.min.js"></script>
<script src="/assets/js/jquery.scrolly.min.js"></script>
<script src="/assets/js/skel.min.js"></script>
<script src="/assets/js/util.js"></script>
<script src="/assets/js/main.js"></script>

			<script async src="https://www.googletagmanager.com/gtag/js?id=UA-80507808-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-80507808-1');
</script>


	</body>
</html>
